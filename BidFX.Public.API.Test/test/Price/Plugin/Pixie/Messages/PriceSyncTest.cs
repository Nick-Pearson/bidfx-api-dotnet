using System.IO;
using NUnit.Framework;

namespace BidFX.Public.API.Price.Plugin.Pixie.Messages
{
    public class PriceSyncTest
    {
        private static readonly byte[] EncodedMessage =
        {
            1, 1, 181, 203, 168, 207, 206, 43, 250, 1, 1, 6, 74, 99, 224, 22, 103, 96, 96, 140, 121, 249, 74, 53,
            148, 69, 196, 200, 220, 210, 208, 196, 220, 208, 212, 196, 204, 194, 220, 204, 194, 200, 210, 208, 192, 148,
            107, 195, 239, 197, 33, 28, 13, 135, 174, 235, 179, 129, 88, 140, 75, 24, 153, 150, 48, 178, 30, 184, 186,
            32, 132, 29, 36, 200, 9, 98, 49, 220, 62, 181, 226, 252, 57, 237, 52, 70, 152, 89, 74, 154, 44, 34, 230,
            102, 134, 70, 198, 134, 22, 22, 38, 230, 102, 102, 38, 134, 70, 102, 102, 166, 38, 92, 15, 158, 46, 133,
            154, 5, 98, 49, 6, 48, 5, 176, 30, 184, 49, 31, 102, 18, 144, 197, 176, 234, 36, 216, 36, 38, 152, 73, 42,
            162, 216, 76, 50, 229, 186, 112, 237, 68, 54, 196, 36, 16, 139, 209, 133, 201, 133, 245, 64, 199, 137, 108,
            168, 73, 64, 22, 67, 11, 196, 77, 204, 248, 253, 103, 201, 181, 96, 238, 131, 74, 136, 73, 32, 22, 212, 127,
            23, 230, 223, 170, 132, 152, 5, 98, 193, 252, 199, 2, 51, 75, 249, 9, 166, 89, 6, 22, 70, 92, 13, 159, 166,
            28, 12, 134, 24, 6, 102, 50, 30, 98, 98, 58, 196, 196, 122, 96, 202, 245, 61, 193, 80, 167, 129, 152, 12,
            61, 96, 243, 138, 89, 125, 236, 157, 19, 243, 146, 83, 115, 20, 116, 21, 140, 129, 216, 47, 95, 161, 160,
            40, 51, 57, 181, 88, 33, 177, 44, 49, 51, 39, 49, 41, 39, 85, 33, 45, 191, 72, 33, 184, 50, 55, 41, 63, 39,
            58, 52, 216, 69, 223, 43, 32, 50, 86, 33, 36, 53, 47, 191, 40, 58, 56, 32, 22, 0, 0, 0, 255, 255
        };

        [Test]
        public void DecodeMessage()
        {
            PriceSync priceSync = new PriceSync(new MemoryStream(EncodedMessage), new ZlibStreamInflator());
            Assert.AreEqual(250, priceSync.ConflationLatency);
            Assert.AreEqual(1, priceSync.Edition);
            Assert.AreEqual(1, priceSync.Options);
            Assert.AreEqual(1, priceSync.Revision);
            Assert.AreEqual(1498573055413, priceSync.RevisionTime);
            Assert.AreEqual(6, priceSync.Size);
            Assert.IsTrue(priceSync.IsCompressed());
        }
    }
}